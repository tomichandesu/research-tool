{% extends "base.html" %}
{% block title %}リサーチ履歴{% endblock %}

{% block content %}
<h1>リサーチ履歴</h1>

{% if jobs %}
<table class="table">
    <thead>
        <tr>
            <th>キーワード</th>
            <th>モード</th>
            <th>ステータス</th>
            <th>候補数</th>
            <th>作成日時</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    {% for j in jobs %}
        <tr>
            <td>
                {{ j.keyword }}
                {% if j.batch_group_id %}
                <span class="badge" style="background: #1565c0; color: #fff; font-size: 0.75em; margin-left: 0.25em;">一括 #{{ j.batch_position }}</span>
                {% endif %}
            </td>
            <td>
                {% if j.batch_group_id %}
                <span class="badge" style="background: #1565c0; color: #fff;">一括オート</span>
                {% else %}
                <span class="badge" style="background: #e65100; color: #fff;">詳細オート</span>
                {% endif %}
            </td>
            <td>
                <span class="badge badge-{{ j.status }}">
                    {%- if j.status == 'pending' -%}順番待ち
                    {%- elif j.status == 'running' -%}リサーチ中
                    {%- elif j.status == 'completed' -%}完了
                    {%- elif j.status == 'failed' -%}エラー
                    {%- elif j.status == 'cancelled' -%}キャンセル
                    {%- else -%}{{ j.status }}{%- endif -%}
                </span>
            </td>
            <td>
                {% if j.result_summary %}
                {% set s = j.result_summary | from_json %}
                {{ s.candidates_count if s else '-' }}
                {% else %}-{% endif %}
            </td>
            <td>{{ j.created_at|jst }}</td>
            <td><a href="/research/{{ j.id }}" class="btn btn-sm btn-outline">詳細</a></td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>リサーチ履歴がありません。</p>
{% endif %}
{% endblock %}

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Research Session Report</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Segoe UI','Meiryo','Hiragino Sans',sans-serif;background:#f0f2f5;color:#333;padding:20px}
.dashboard{background:#fff;border-radius:12px;padding:24px;margin-bottom:24px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
.dashboard h1{font-size:22px;color:#1a1a2e;margin-bottom:12px}
.dashboard .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px;margin-bottom:16px}
.stat-card{background:#f8f9fa;border-radius:8px;padding:16px;text-align:center}
.stat-card .label{font-size:12px;color:#888;margin-bottom:4px}
.stat-card .value{font-size:24px;font-weight:bold;color:#1a1a2e}
.top-keywords{font-size:13px;color:#666;margin-top:12px}
.top-keywords span{display:inline-block;background:#e3f2fd;color:#1565c0;padding:2px 8px;border-radius:12px;margin:2px 4px;font-size:12px}

.kw-section{background:#fff;border-radius:12px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,.06);overflow:hidden}
.kw-header{padding:16px 20px;cursor:pointer;display:flex;align-items:center;gap:12px;border-bottom:1px solid #eee;user-select:none}
.kw-header:hover{background:#f8f9fa}
.kw-header .arrow{transition:transform .2s;font-size:12px;color:#888}
.kw-header .arrow.open{transform:rotate(90deg)}
.kw-header .kw-name{font-size:16px;font-weight:bold;color:#1a1a2e;flex:1}
.kw-header .kw-meta{font-size:12px;color:#888}
.badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:12px;font-weight:bold;margin-right:8px}
.badge-3{background:#c8e6c9;color:#2e7d32}
.badge-2{background:#fff9c4;color:#f57f17}
.badge-1{background:#ffccbc;color:#bf360c}
.badge-0{background:#f5f5f5;color:#999}
.kw-body{display:none;padding:16px 20px}
.kw-body.open{display:block}

.product-card{background:#fff;border-radius:12px;padding:24px;margin-bottom:24px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.product-num{display:inline-block;background:#1a1a2e;color:#fff;font-size:12px;font-weight:bold;padding:2px 10px;border-radius:12px;margin-bottom:12px}
.amazon-section{display:flex;gap:16px;padding-bottom:16px;border-bottom:1px solid #eee;margin-bottom:16px}
.amazon-img{width:130px;height:130px;object-fit:contain;border:1px solid #eee;border-radius:8px;background:#fafafa;flex-shrink:0}
.amazon-info{flex:1;min-width:0}
.amazon-info h3{font-size:14px;color:#333;margin-bottom:8px;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.amazon-price{font-size:20px;font-weight:bold;color:#B12704;margin-bottom:6px}
.amazon-details{font-size:12px;color:#666;line-height:1.8}
.amazon-details span{display:inline-block;margin-right:12px}
.amazon-link{font-size:12px;color:#0066c0;text-decoration:none;margin-top:4px;display:inline-block}
.amazon-link:hover{text-decoration:underline}

.candidates-label{font-size:13px;font-weight:bold;color:#555;margin-bottom:12px}
.candidates-row{display:flex;gap:12px;flex-wrap:wrap}
.candidate{border:2px solid #e0e0e0;border-radius:10px;padding:10px;width:175px;transition:all .15s;background:#fff}
.candidate:hover{border-color:#90CAF9;transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.1)}
.candidate-img{width:100%;height:140px;object-fit:contain;border-radius:6px;background:#fafafa;display:block}
.candidate-price{font-size:16px;font-weight:bold;color:#c62828;margin:8px 0 4px}
.candidate-profit{font-size:13px;font-weight:bold;margin-bottom:4px}
.candidate-profit.good{color:#2E7D32}
.candidate-profit.mid{color:#F57F17}
.candidate-profit.low{color:#c62828}
.candidate-detail{font-size:11px;color:#888;margin-bottom:4px}
.candidate-title{font-size:10px;color:#555;margin-bottom:4px;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.candidate-link{font-size:11px;color:#1565C0;text-decoration:none;word-break:break-all;display:block;margin-top:4px}
.candidate-link:hover{text-decoration:underline}
.candidate-shop{font-size:10px;color:#999;margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
</style>
</head>
<body>

<div class="dashboard" id="dashboard"></div>
<div id="kwSections"></div>

<script>
var DATA = {"generated_at": "2026-02-14 02:14:20", "stats": {"total_keywords": 2, "total_candidates": 1, "elapsed_seconds": 120.5, "elapsed_str": "0\u6642\u95932\u52060\u79d2"}, "keywords": [{"keyword": "\u30c6\u30b9\u30c8\u98a8\u8239", "score": 25.5, "total_searched": 24, "pass_count": 3, "products": [{"amazon": {"asin": "B0TEST001", "title": "OBEST \u30d0\u30eb\u30fc\u30f3\u30dd\u30f3\u30d7 \u96fb\u52d5 \u98a8\u8239 \u7a7a\u6c17\u5165\u308c '\u30c6\u30b9\u30c8' \u5546\u54c1", "price": 3299, "image_url": "https://m.media-amazon.com/images/I/61zK1hM-nAL._AC_SY450_.jpg", "bsr": 6499, "category": "\u304a\u3082\u3061\u3083", "rating": 4.2, "seller_name": "xuxuhjao\n \uff084\u4ef6\u306e\u8a55\u4fa1\uff09", "variation_count": 1, "dimensions": [25.0, 13.0, 12.0], "weight_kg": 0.5, "product_url": "https://www.amazon.co.jp/dp/B0TEST001", "estimated_monthly_sales": 150, "estimated_monthly_revenue": 494850}, "candidates": [{"alibaba": {"title": "\u7535\u52a8\u6c14\u7403\u5145\u6c14\u6cf5 balloon pump", "price_cny": 15.5, "image_url": "https://example.com/img.jpg", "product_url": "https://detail.1688.com/offer/123.html", "shop_name": "\u5e7f\u5dde\\\u67d0\u67d0\u5e97\u94fa", "min_order": "2\u500b"}, "combined_score": 0.72, "profit": {"profit": 1500, "profit_rate_percentage": 45.5, "total_cost": 1799}}]}, {"amazon": {"asin": "B0TEST002", "title": "Skingwa \u30c6\u30b9\u30c8's \"special\" item\twith\ttabs", "price": 1999, "image_url": "https://m.media-amazon.com/images/I/test.jpg", "bsr": 12000, "category": "\u30db\u30fc\u30e0\uff06\u30ad\u30c3\u30c1\u30f3", "rating": 2.3, "seller_name": "Skingwa-jp\n \uff089\u4ef6\u306e\u8a55\u4fa1\uff09", "variation_count": 3, "dimensions": [10.0, 8.0, 5.0], "weight_kg": 0.2, "product_url": "https://www.amazon.co.jp/dp/B0TEST002", "estimated_monthly_sales": 80, "estimated_monthly_revenue": 159920}, "candidates": []}]}, {"keyword": "\u30c6\u30b9\u30c8\u96a0\u308c\u5bb6", "score": 0.0, "total_searched": 24, "pass_count": 0, "products": []}]};

function init() {
  renderDashboard();
  renderKeywordSections();
}

function renderDashboard() {
  var s = DATA.stats;
  var seenAsins = {};
  var totalProducts = 0;
  var totalDuplicates = 0;
  DATA.keywords.forEach(function(kw) {
    kw.products.forEach(function(p) {
      var asin = p.amazon && p.amazon.asin;
      if (p.is_duplicate) { totalDuplicates++; return; }
      if (asin && !seenAsins[asin]) {
        seenAsins[asin] = true;
        totalProducts++;
      }
    });
  });

  var topKws = DATA.keywords.slice(0, 5);
  var topHtml = topKws.map(function(kw) {
    return '<span>' + esc(kw.keyword) + ' (' + kw.score + ')</span>';
  }).join('');

  document.getElementById('dashboard').innerHTML =
    '<h1>Auto Research Session Report</h1>' +
    '<div class="stats-grid">' +
      '<div class="stat-card"><div class="label">KW</div><div class="value">' + s.total_keywords + '</div></div>' +
      '<div class="stat-card"><div class="label">Candidate KW</div><div class="value">' + DATA.keywords.length + '</div></div>' +
      '<div class="stat-card"><div class="label">Products</div><div class="value">' + totalProducts + '</div></div>' +
      (totalDuplicates > 0 ? '<div class="stat-card"><div class="label">Duplicates</div><div class="value" style="color:#999">' + totalDuplicates + '</div></div>' : '') +
      '<div class="stat-card"><div class="label">Time</div><div class="value">' + esc(s.elapsed_str) + '</div></div>' +
    '</div>' +
    '<div class="top-keywords">Top: ' + topHtml + '</div>' +
    '<div style="font-size:12px;color:#999;margin-top:8px">' + esc(DATA.generated_at) + '</div>';
}

function renderKeywordSections() {
  var container = document.getElementById('kwSections');
  DATA.keywords.forEach(function(kwData, ki) {
    container.appendChild(buildKwSection(kwData, ki));
  });
}

function buildKwSection(kwData, ki) {
  var section = document.createElement('div');
  section.className = 'kw-section';

  var badge = scoreBadge(kwData.score);
  var headerHtml =
    '<div class="kw-header" onclick="toggleSection(this)">' +
      '<span class="arrow">&#9654;</span>' +
      badge +
      '<span class="kw-name">' + esc(kwData.keyword) + '</span>' +
      '<span class="kw-meta">Score: ' + kwData.score +
        ' | ' + kwData.pass_count + '/' + kwData.total_searched +
        ' | ' + kwData.products.length + ' items</span>' +
    '</div>';

  var bodyHtml = '<div class="kw-body">';
  kwData.products.forEach(function(prod, pi) {
    bodyHtml += buildProductCard(prod, pi);
  });
  bodyHtml += '</div>';

  section.innerHTML = headerHtml + bodyHtml;
  return section;
}

function buildProductCard(prod, pi) {
  var am = prod.amazon;
  var dims = am.dimensions ? am.dimensions[0]+'x'+am.dimensions[1]+'x'+am.dimensions[2]+'cm' : '-';
  var weight = am.weight_kg ? am.weight_kg+'kg' : '-';

  var isDup = prod.is_duplicate;
  var html = '<div class="product-card"' + (isDup ? ' style="opacity:0.6;border-left:4px solid #e53935"' : '') + '>';
  html += '<span class="product-num">#' + (pi+1) + '</span>';
  if (isDup) html += '<span style="background:#e53935;color:#fff;font-size:12px;font-weight:bold;padding:2px 10px;border-radius:12px;margin-left:8px">&#37325;&#35079;</span>';
  html += '<div class="amazon-section">';
  html += '<img class="amazon-img" src="' + esc(am.image_url) + '" onerror="this.style.display=\'none\'">';
  html += '<div class="amazon-info">';
  html += '<h3>' + esc(am.title) + '</h3>';
  html += '<div class="amazon-price">&yen;' + num(am.price) + '</div>';
  html += '<div class="amazon-details">';
  html += '<span>ASIN: ' + am.asin + '</span>';
  html += '<span>BSR: ' + num(am.bsr) + '</span>';
  html += '<span>&#12524;&#12499;&#12517;&#12540;: ' + am.review_count + '&#20214;</span>';
  if (am.rating) html += '<span>&#9733;' + am.rating + '</span>';
  html += '<span>' + (am.is_fba ? 'FBA' : 'FBM') + '</span>';
  html += '<span>&#12496;&#12522;&#12456;: ' + (am.variation_count || 1) + '</span>';
  html += '<span>&#23544;&#27861;: ' + dims + '</span>';
  html += '<span>&#37325;&#37327;: ' + weight + '</span>';
  html += '</div>';
  html += '<div class="amazon-details"><span>&#26376;&#38291;&#36009;&#22770;: ' + num(prod.estimated_monthly_sales) + '&#20491;</span>';
  html += '<span>&#26376;&#38291;&#22770;&#19978;: &yen;' + num(prod.estimated_monthly_revenue) + '</span></div>';
  if (am.seller_name) html += '<div class="amazon-details"><span>&#12475;&#12521;&#12540;: ' + esc(am.seller_name) + '</span></div>';
  html += '<a class="amazon-link" href="' + esc(am.product_url || ('https://www.amazon.co.jp/dp/' + am.asin)) + '" target="_blank">Amazon &#12391;&#35211;&#12427; &rarr;</a>';
  html += '</div></div>';

  // Candidates
  var cands = prod.candidates || [];
  if (cands.length > 0) {
    html += '<div class="candidates-label">1688&#20505;&#35036; (' + cands.length + '&#20214;)</div>';
    html += '<div class="candidates-row">';
    cands.forEach(function(cand) {
      var profitPct = cand.profit.profit_rate_percentage || 0;
      var profitClass = profitPct >= 25 ? 'good' : profitPct >= 15 ? 'mid' : 'low';
      html += '<div class="candidate">';
      html += '<img class="candidate-img" src="' + esc(cand.alibaba.image_url) + '" onerror="this.style.display=\'none\'">';
      if (cand.alibaba.title) html += '<div class="candidate-title">' + esc(cand.alibaba.title) + '</div>';
      html += '<div class="candidate-price">' + cand.alibaba.price_cny + '&#20803;</div>';
      html += '<div class="candidate-profit ' + profitClass + '">&#21033;&#30410;: &yen;' + num(cand.profit.profit) + ' (' + profitPct + '%)</div>';
      html += '<div class="candidate-detail">&#32207;&#12467;&#12473;&#12488;: &yen;' + num(cand.profit.total_cost) + '</div>';
      html += '<div class="candidate-detail">&#39006;&#20284;&#24230;: ' + ((cand.combined_score || 0) * 100).toFixed(1) + '%</div>';
      if (cand.alibaba.min_order) html += '<div class="candidate-detail">&#26368;&#23567;&#12525;&#12483;&#12488;: ' + cand.alibaba.min_order + '</div>';
      if (cand.alibaba.product_url) html += '<a class="candidate-link" href="' + esc(cand.alibaba.product_url) + '" target="_blank">1688 &rarr;</a>';
      if (cand.alibaba.shop_name) html += '<div class="candidate-shop">' + esc(cand.alibaba.shop_name) + '</div>';
      html += '</div>';
    });
    html += '</div>';
  }

  html += '</div>';
  return html;
}

function toggleSection(header) {
  var arrow = header.querySelector('.arrow');
  var body = header.nextElementSibling;
  if (body.classList.contains('open')) {
    body.classList.remove('open');
    arrow.classList.remove('open');
  } else {
    body.classList.add('open');
    arrow.classList.add('open');
  }
}

function scoreBadge(score) {
  if (score >= 30) return '<span class="badge badge-3">&#9733;&#9733;&#9733;</span>';
  if (score >= 15) return '<span class="badge badge-2">&#9733;&#9733;</span>';
  if (score > 0)  return '<span class="badge badge-1">&#9733;</span>';
  return '<span class="badge badge-0">&#9734;</span>';
}

function esc(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function num(n) {
  if (n == null) return '-';
  return Number(n).toLocaleString();
}

init();
</script>
</body>
</html>
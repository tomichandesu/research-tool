# Amazon-1688 中国製品リサーチシステム 要件定義書

**Spec ID**: `amazon-china-research`
**Version**: 1.0.0
**Created**: 2026-02-02
**Status**: Draft → Review → Approved

---

## 1. Executive Summary

### 1.1 プロジェクト概要

| 項目 | 内容 |
|------|------|
| **プロジェクト名** | Amazon-1688 中国製品リサーチシステム |
| **目的** | Amazonで販売されている中国製品を自動検出し、1688での仕入れ先を特定、利益計算を行う |
| **対象ユーザー** | Amazon物販セラー、中国輸入ビジネス事業者 |
| **コスト制約** | **完全無料（外部API課金なし）** |
| **開発環境** | Claude Code + Python + Playwright |

### 1.2 ビジネス目標

| ID | 目標 | 成功指標 |
|----|------|---------|
| BG-001 | リサーチ時間の削減 | 手動作業の80%以上を自動化 |
| BG-002 | 利益商品の発見率向上 | 月間10件以上の有望商品を発見 |
| BG-003 | コストゼロ運用 | 外部API費用ゼロ円を維持 |

---

## 2. Stakeholders（ステークホルダー）

| ID | ステークホルダー | 役割 | 関心事 |
|----|-----------------|------|--------|
| SH-001 | Amazon物販セラー | 主要ユーザー | 利益商品の発見、作業効率化 |
| SH-002 | システム開発者 | 開発・保守 | 保守性、拡張性 |
| SH-003 | 中国輸入代行業者 | 連携パートナー | 正確な商品特定 |

---

## 3. Functional Requirements（機能要件）

### 3.1 商品検索機能（FR-100系）

#### FR-101: キーワード検索

| 項目 | 内容 |
|------|------|
| **ID** | FR-101 |
| **タイトル** | Amazonキーワード検索 |
| **EARS形式** | **When** ユーザーがキーワードを入力する **the system shall** Amazon.co.jpで該当キーワードの商品一覧を取得する |
| **優先度** | Must |
| **受け入れ基準** | AC-101-1: 「貯金箱」で検索時、100件以上の商品が取得できること<br>AC-101-2: 各商品のASIN、タイトル、価格、画像URLが取得できること<br>AC-101-3: 検索結果は30秒以内に返却されること |

#### FR-102: 商品詳細取得

| 項目 | 内容 |
|------|------|
| **ID** | FR-102 |
| **タイトル** | 商品詳細ページからのデータ取得 |
| **EARS形式** | **When** 商品ASINが指定される **the system shall** 商品詳細ページから以下の情報を取得する：BSR（大カテゴリーランキング）、レビュー数、FBA/FBM判定、商品画像URL |
| **優先度** | Must |
| **受け入れ基準** | AC-102-1: BSRが数値として取得できること（例：1,234位 → 1234）<br>AC-102-2: レビュー数が数値として取得できること<br>AC-102-3: FBA/FBMが正しく判定できること<br>AC-102-4: 1商品あたり5秒以内に処理完了すること |

#### FR-103: カテゴリー情報取得

| 項目 | 内容 |
|------|------|
| **ID** | FR-103 |
| **タイトル** | 大カテゴリー名の取得 |
| **EARS形式** | **When** 商品詳細を取得する **the system shall** 該当商品の大カテゴリー名（例：ホーム&キッチン）を取得する |
| **優先度** | Should |
| **受け入れ基準** | AC-103-1: 大カテゴリー名が文字列として取得できること<br>AC-103-2: カテゴリーが取得できない場合は「不明」とすること |

---

### 3.2 フィルタリング機能（FR-200系）

#### FR-201: 価格フィルタ

| 項目 | 内容 |
|------|------|
| **ID** | FR-201 |
| **タイトル** | 価格による絞り込み |
| **EARS形式** | **When** 商品リストがある **the system shall** 価格が1,500円以上の商品のみを抽出する |
| **優先度** | Must |
| **受け入れ基準** | AC-201-1: 1,499円以下の商品が除外されること<br>AC-201-2: 1,500円の商品は含まれること<br>AC-201-3: 価格閾値は設定可能であること |

#### FR-202: レビュー数フィルタ

| 項目 | 内容 |
|------|------|
| **ID** | FR-202 |
| **タイトル** | レビュー数による絞り込み |
| **EARS形式** | **When** 商品リストがある **the system shall** レビュー数が40件以下の商品のみを抽出する |
| **優先度** | Must |
| **受け入れ基準** | AC-202-1: レビュー41件以上の商品が除外されること<br>AC-202-2: レビュー40件の商品は含まれること<br>AC-202-3: レビュー閾値は設定可能であること |

#### FR-203: 販売数フィルタ（FBA）

| 項目 | 内容 |
|------|------|
| **ID** | FR-203 |
| **タイトル** | FBA商品の販売数フィルタ |
| **EARS形式** | **When** FBA商品を評価する **the system shall** BSRから推定月間販売数を計算し、月売上2万円以上の商品のみを抽出する |
| **優先度** | Must |
| **受け入れ基準** | AC-203-1: BSR 15,000位以内の商品が概ね通過すること<br>AC-203-2: 月売上 = 推定販売数 × 価格 で計算されること<br>AC-203-3: 20,000円未満の商品は除外されること |

#### FR-204: 販売数フィルタ（FBM）

| 項目 | 内容 |
|------|------|
| **ID** | FR-204 |
| **タイトル** | FBM商品の販売数フィルタ |
| **EARS形式** | **When** FBM商品を評価する **the system shall** BSRから推定月間販売数を計算し、月3個以上販売している商品のみを抽出する |
| **優先度** | Must |
| **受け入れ基準** | AC-204-1: BSR 30,000位以内の商品が概ね通過すること<br>AC-204-2: 推定月間販売数3個未満の商品は除外されること |

#### FR-205: BSRから販売数推定

| 項目 | 内容 |
|------|------|
| **ID** | FR-205 |
| **タイトル** | BSRから月間販売数を推定 |
| **EARS形式** | **When** BSRとカテゴリーが与えられる **the system shall** 以下の目安表に基づき月間販売数を推定する |
| **優先度** | Must |
| **推定ロジック** | BSR 1-3,000位: 300個以上<br>BSR 3,000-10,000位: 50-300個<br>BSR 10,000-20,000位: 約20個<br>BSR 20,000-30,000位: 1-20個 |
| **受け入れ基準** | AC-205-1: BSR 5,000位の商品で推定販売数が50-300個の範囲になること<br>AC-205-2: カテゴリー係数を適用できること |

---

### 3.3 画像マッチング機能（FR-300系）

#### FR-301: 1688画像検索

| 項目 | 内容 |
|------|------|
| **ID** | FR-301 |
| **タイトル** | 1688での画像検索実行 |
| **EARS形式** | **When** Amazon商品の画像URLが与えられる **the system shall** 1688の画像検索機能を使用して類似商品を検索する |
| **優先度** | Must |
| **受け入れ基準** | AC-301-1: 画像URLを1688の検索ページに入力できること<br>AC-301-2: 検索結果から上位10件の商品情報を取得できること<br>AC-301-3: 検索は10秒以内に完了すること |

#### FR-302: 画像完全一致判定

| 項目 | 内容 |
|------|------|
| **ID** | FR-302 |
| **タイトル** | pHashによる画像完全一致判定 |
| **EARS形式** | **When** Amazon画像と1688画像がある **the system shall** pHash（Perceptual Hash）を使用して完全一致を判定する |
| **優先度** | Must |
| **判定基準** | ハミング距離 ≤ 5 で「完全一致」と判定 |
| **受け入れ基準** | AC-302-1: 同一画像のハミング距離が0になること<br>AC-302-2: リサイズ画像のハミング距離が5以下になること<br>AC-302-3: 異なる画像のハミング距離が10以上になること |

#### FR-303: 1688商品情報取得

| 項目 | 内容 |
|------|------|
| **ID** | FR-303 |
| **タイトル** | マッチした1688商品の詳細取得 |
| **EARS形式** | **When** 画像が完全一致した1688商品がある **the system shall** 該当商品の価格（元）、最小ロット数、ショップ情報を取得する |
| **優先度** | Must |
| **受け入れ基準** | AC-303-1: 価格が数値（元）として取得できること<br>AC-303-2: 商品URLが取得できること |

---

### 3.4 利益計算機能（FR-400系）

#### FR-401: 利益計算

| 項目 | 内容 |
|------|------|
| **ID** | FR-401 |
| **タイトル** | 利益・利益率の計算 |
| **EARS形式** | **When** Amazon価格と1688価格がある **the system shall** 以下の計算式で利益を算出する |
| **計算式** | 利益 = Amazon価格 - (1688価格×為替 + 国際送料 + 関税 + Amazon紹介料 + FBA手数料) |
| **優先度** | Must |
| **受け入れ基準** | AC-401-1: 利益が正確に計算されること<br>AC-401-2: 利益率（%）が計算されること<br>AC-401-3: 各コスト項目が明細として出力されること |

#### FR-402: 為替レート

| 項目 | 内容 |
|------|------|
| **ID** | FR-402 |
| **タイトル** | 為替レートの適用 |
| **EARS形式** | **The system shall** 1元 = 21.5円の為替レートをデフォルトとし、設定変更可能とする |
| **優先度** | Must |
| **受け入れ基準** | AC-402-1: デフォルト為替レートが21.5円であること<br>AC-402-2: ユーザーが為替レートを変更できること |

#### FR-403: 送料計算

| 項目 | 内容 |
|------|------|
| **ID** | FR-403 |
| **タイトル** | 国際送料の概算 |
| **EARS形式** | **The system shall** 重量ベースの国際送料を1,300円/kgとして計算する（デフォルト重量: 0.5kg） |
| **優先度** | Should |
| **受け入れ基準** | AC-403-1: デフォルト送料が650円（0.5kg×1,300円）であること<br>AC-403-2: 重量を指定した場合、正しく計算されること |

#### FR-404: Amazon手数料計算

| 項目 | 内容 |
|------|------|
| **ID** | FR-404 |
| **タイトル** | Amazon紹介料・FBA手数料の計算 |
| **EARS形式** | **The system shall** カテゴリ別紹介料（8-15%）とFBA手数料（290-530円）を計算する |
| **優先度** | Must |
| **受け入れ基準** | AC-404-1: ホーム&キッチンカテゴリで15%の紹介料が適用されること<br>AC-404-2: FBA商品にFBA手数料が加算されること<br>AC-404-3: FBM商品にはFBA手数料が加算されないこと |

---

### 3.5 出力機能（FR-500系）

#### FR-501: CSV出力

| 項目 | 内容 |
|------|------|
| **ID** | FR-501 |
| **タイトル** | 検索結果のCSV出力 |
| **EARS形式** | **When** リサーチが完了する **the system shall** 結果をCSVファイルとして出力する |
| **優先度** | Must |
| **出力カラム** | ASIN, タイトル, Amazon価格, BSR, レビュー数, FBA/FBM, 1688価格, 1688URL, 利益, 利益率 |
| **受け入れ基準** | AC-501-1: UTF-8エンコードのCSVが出力されること<br>AC-501-2: Excelで正しく開けること<br>AC-501-3: 全カラムにデータが含まれること |

#### FR-502: 進捗表示

| 項目 | 内容 |
|------|------|
| **ID** | FR-502 |
| **タイトル** | 処理進捗の表示 |
| **EARS形式** | **While** リサーチ処理中 **the system shall** 現在の処理状況（X/Y件完了）を表示する |
| **優先度** | Should |
| **受け入れ基準** | AC-502-1: 処理件数が表示されること<br>AC-502-2: エラー発生時にスキップして継続すること |

---

## 4. Non-Functional Requirements（非機能要件）

### 4.1 性能要件（NFR-100系）

#### NFR-101: 処理速度

| 項目 | 内容 |
|------|------|
| **ID** | NFR-101 |
| **タイトル** | 処理速度要件 |
| **要件** | 100件の商品リサーチを15分以内に完了すること |
| **受け入れ基準** | AC-NFR-101: キーワード「貯金箱」で100件のリサーチが15分以内に完了すること |

#### NFR-102: 同時実行

| 項目 | 内容 |
|------|------|
| **ID** | NFR-102 |
| **タイトル** | 同時実行制限 |
| **要件** | Amazon/1688へのアクセスは1リクエスト/2秒以上の間隔を空けること |
| **理由** | レート制限・ブロック回避 |

### 4.2 コスト要件（NFR-200系）

#### NFR-201: 外部API費用

| 項目 | 内容 |
|------|------|
| **ID** | NFR-201 |
| **タイトル** | 外部API費用ゼロ |
| **要件** | Keepa API等の有料APIを使用せず、完全無料で運用できること |
| **受け入れ基準** | AC-NFR-201: 月額費用が0円であること |

### 4.3 信頼性要件（NFR-300系）

#### NFR-301: エラーハンドリング

| 項目 | 内容 |
|------|------|
| **ID** | NFR-301 |
| **タイトル** | エラー時の継続性 |
| **要件** | 1件の処理でエラーが発生しても、全体処理を継続すること |
| **受け入れ基準** | AC-NFR-301: 100件中5件がエラーでも、残り95件の結果が出力されること |

#### NFR-302: ログ出力

| 項目 | 内容 |
|------|------|
| **ID** | NFR-302 |
| **タイトル** | 処理ログの記録 |
| **要件** | 処理開始時刻、終了時刻、処理件数、エラー件数をログに記録すること |

### 4.4 保守性要件（NFR-400系）

#### NFR-401: 設定ファイル

| 項目 | 内容 |
|------|------|
| **ID** | NFR-401 |
| **タイトル** | 外部設定ファイル |
| **要件** | フィルタ条件（価格閾値、レビュー閾値等）を外部設定ファイルで管理すること |
| **形式** | YAML または JSON |

#### NFR-402: モジュール分離

| 項目 | 内容 |
|------|------|
| **ID** | NFR-402 |
| **タイトル** | モジュール分離 |
| **要件** | Amazon巡回、1688検索、画像マッチング、利益計算を独立モジュールとして実装すること |

---

## 5. Technical Constraints（技術制約）

### 5.1 技術スタック

| レイヤー | 技術 | バージョン |
|---------|------|-----------|
| 言語 | Python | 3.10+ |
| ブラウザ自動化 | Playwright | 最新 |
| 画像処理 | imagehash, Pillow | 最新 |
| MCP | Playwright MCP | 最新 |
| 開発環境 | Claude Code | 最新 |

### 5.2 制約事項

| ID | 制約 | 理由 |
|----|------|------|
| TC-001 | 有料APIの使用禁止 | コストゼロ要件 |
| TC-002 | Amazonの利用規約遵守 | 法的リスク回避 |
| TC-003 | 1688の利用規約遵守 | 法的リスク回避 |
| TC-004 | レート制限の遵守 | ブロック回避 |

---

## 6. Data Requirements（データ要件）

### 6.1 入力データ

| ID | データ | 形式 | 説明 |
|----|--------|------|------|
| DI-001 | 検索キーワード | 文字列 | 例：「貯金箱」 |
| DI-002 | フィルタ条件 | YAML/JSON | 価格、レビュー数等 |

### 6.2 出力データ

| ID | データ | 形式 | 説明 |
|----|--------|------|------|
| DO-001 | リサーチ結果 | CSV | 商品一覧と利益情報 |
| DO-002 | 処理ログ | TXT | 実行履歴 |

### 6.3 中間データ

| ID | データ | 説明 |
|----|--------|------|
| DM-001 | Amazon商品リスト | 検索結果の一時保存 |
| DM-002 | 画像ハッシュキャッシュ | 重複計算防止 |

---

## 7. User Stories（ユーザーストーリー）

### US-001: 基本リサーチフロー

```
As a Amazon物販セラー
I want to キーワードを入力するだけで利益商品を見つける
So that リサーチ時間を大幅に削減できる
```

**受け入れ基準**:
- キーワード入力から結果出力まで15分以内
- CSVで結果をダウンロードできる
- 利益率順にソートされている

### US-002: フィルタ条件のカスタマイズ

```
As a 経験豊富なセラー
I want to フィルタ条件を自分で調整できる
So that 自分の仕入れ基準に合った商品を見つけられる
```

**受け入れ基準**:
- 価格閾値を変更できる
- レビュー閾値を変更できる
- 販売数条件を変更できる

### US-003: エラー時の継続

```
As a システムユーザー
I want to 一部の商品でエラーが出ても処理を継続してほしい
So that 大量リサーチ時に最初からやり直す必要がない
```

**受け入れ基準**:
- エラー商品はスキップされる
- エラー内容がログに記録される
- 正常な商品は結果に含まれる

---

## 8. Acceptance Tests（受け入れテスト）

### AT-001: E2E基本フロー

| 項目 | 内容 |
|------|------|
| **テストID** | AT-001 |
| **テスト名** | 基本リサーチフローのE2Eテスト |
| **前提条件** | システムが起動していること |
| **手順** | 1. キーワード「貯金箱」を入力<br>2. リサーチ実行<br>3. 結果CSVを確認 |
| **期待結果** | ・処理が完了すること<br>・CSVに商品データが含まれること<br>・利益情報が計算されていること |

### AT-002: フィルタリング精度

| 項目 | 内容 |
|------|------|
| **テストID** | AT-002 |
| **テスト名** | フィルタリング条件の精度テスト |
| **手順** | 1. 価格1,500円以上フィルタを適用<br>2. 結果を確認 |
| **期待結果** | ・結果に1,499円以下の商品が含まれないこと |

### AT-003: 画像マッチング精度

| 項目 | 内容 |
|------|------|
| **テストID** | AT-003 |
| **テスト名** | 画像完全一致判定の精度テスト |
| **手順** | 1. 同一画像のペアでテスト<br>2. 異なる画像のペアでテスト |
| **期待結果** | ・同一画像: マッチと判定<br>・異なる画像: 不一致と判定 |

### AT-004: 利益計算精度

| 項目 | 内容 |
|------|------|
| **テストID** | AT-004 |
| **テスト名** | 利益計算の精度テスト |
| **入力** | Amazon価格: 2,000円, 1688価格: 30元, 重量: 0.5kg |
| **期待結果** | 利益 = 2,000 - (30×21.5 + 650 + 0 + 300 + 420) ≈ -15円 |

---

## 9. Glossary（用語集）

| 用語 | 定義 |
|------|------|
| **ASIN** | Amazon Standard Identification Number。Amazon商品の一意識別子 |
| **BSR** | Best Sellers Rank。Amazonの売れ筋ランキング順位 |
| **FBA** | Fulfillment by Amazon。Amazonによる配送代行サービス |
| **FBM** | Fulfillment by Merchant。出品者による自社配送 |
| **pHash** | Perceptual Hash。画像の視覚的特徴を表すハッシュ値 |
| **1688** | アリババグループが運営する中国国内向けB2Bマーケットプレイス |
| **OEM** | Original Equipment Manufacturer。相手先ブランド製造 |

---

## 10. Revision History（変更履歴）

| バージョン | 日付 | 変更者 | 変更内容 |
|-----------|------|--------|---------|
| 1.0.0 | 2026-02-02 | System | 初版作成 |

---

## 11. Appendix（付録）

### A. BSR-販売数推定テーブル

| ランキング帯 | 月間販売数（目安） | 備考 |
|------------|-------------------|------|
| 1-1,000位 | 1,000個以上 | 非常に売れている |
| 1,000-3,000位 | 300-900個 | よく売れている |
| 3,000-5,000位 | 100-300個 | 売れている |
| 5,000-10,000位 | 50-100個 | まあまあ売れている |
| 10,000-20,000位 | 約20個 | 時々売れる |
| 20,000-30,000位 | 1-20個 | 月に数個 |

### B. Amazon紹介料テーブル

| カテゴリ | 紹介料率 |
|---------|---------|
| ホーム&キッチン | 15% |
| おもちゃ | 15% |
| ビューティー | 10% |
| 家電 | 8% |
| その他 | 15% |

### C. FBA手数料テーブル

| 価格帯 | FBA手数料 |
|--------|----------|
| 1,000円未満 | 290円 |
| 1,000-2,000円 | 420円 |
| 2,000円以上 | 530円 |

---

## 12. Sign-off（承認）

| 役割 | 名前 | 日付 | 署名 |
|------|------|------|------|
| プロダクトオーナー | | | |
| 技術リード | | | |
| QAリード | | | |
